---
- name: Fetch and deploy artifacts from Nexus
  hosts: g1
  become: true

  tasks:
    - name: Remove existing *.war files from webapps folder
      ansible.builtin.shell:
        cmd: "find /opt/tomcat/webapps/ -name '*.war' -type f -delete"
      ignore_errors: yes
      register: results
      become: yes

    - debug:
        var: results

    - name: Fetch .war files from Nexus
      ansible.builtin.uri:
        url: "http://n4:8081/repository/java-artifacts/{{ item.name }}"
        method: GET
        dest: "/opt/tomcat/webapps/{{ item.name }}"
      with_items: "{{ warfile.files }}"
      become: yes
